/* Tailwind v4: import the framework via CSS, then register plugins here */
@import "tailwindcss";
/* tailwindcss-animate plugin can be added via Tailwind config; removed here to avoid editor parse errors */

/* ---- shadcn-style tokens you already use ---- */
@layer base {
  :root {
    --background: 0 0% 98%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    --radius: 1rem;
        /* ---- BloomCrux Bloom Level Tokens ---- */
    --bloom-remember:   #4DA6FF; /* Remember  */
    --bloom-understand: #34C759; /* Understand */
    --bloom-apply:      #FFD60A; /* Apply      */
    --bloom-analyze:    #FF9F0A; /* Analyze    */
    --bloom-evaluate:   #FF375F; /* Evaluate   */
    --bloom-create:     #9D4EDD; /* Create     */

    --radius-md: 12px;
    --shadow-soft: 0 8px 24px rgba(0,0,0,.08);
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
    
    /* ---- BloomCrux dark mode tokens ---- */
    --bloom-remember:   #3B8CE0;
    --bloom-understand: #2FB24F;
    --bloom-apply:      #E6C20A;
    --bloom-analyze:    #E68808;
    --bloom-evaluate:   #E02F55;
    --bloom-create:     #8C3EDA;

    --radius-md: 12px;
    --shadow-soft: 0 8px 24px rgba(0,0,0,.35);
  }
}

/* keep these convenience rules */
@layer base {
  * { border-color: hsl(var(--border)); }
  body { background-color: hsl(var(--background)); color: hsl(var(--foreground)); }
}

/* Study quest helpers */
@layer utilities {
  .dragging { cursor: grabbing !important; }
  .droppable-over { outline: 2px solid var(--bloom-remember); outline-offset: 2px; }
  .focus-ring:focus { outline: 2px solid color(display-p3 0.3 0.45 1 / 0.75); outline-offset: 2px; }

    /* Study layout wrappers */
    .study-page {
      background-color: #f8fafc; /* slate-50 */
      min-height: 100vh;
      font-family: var(--font-ui), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .study-card {
      background-color: #ffffff;
      border-radius: 0.75rem; /* rounded-xl */
      box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      border: 1px solid #e2e8f0; /* slate-200 */
      min-height: 70vh; /* extend card toward bottom as requested */
    }
    .study-body {
      font-family: var(--font-content), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 1.25rem; /* text-xl scale for card content */
      line-height: 1.75rem;
    }
  .font-valid { font-family: var(--font-ui), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  .font-lalo { font-family: var(--font-content), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  .font-nav { font-family: var(--font-nav, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"); }
}

@layer base {
  :root{
    --primary-color:#2563eb;
    --secondary-color:#ffffff;
    --background-color:#f8fafc;
    --text-primary:#0f172a;
    --text-secondary:#475569;
    --accent-color:#3b82f6;
    --hud-blue:#0284c7;
    --hud-yellow:#ca8a04;
    --hud-green:#16a34a;
    --hud-purple:#7c3aed;
  }
}
@layer utilities{
  .bg-grid-pattern{
    background-image:
      linear-gradient(#e2e8f0 1px,transparent 1px),
      linear-gradient(to right,#e2e8f0 1px,transparent 1px);
    background-size:2rem 2rem;
  }
  @keyframes rotate-slow{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  .animate-rotate-slow{animation:rotate-slow 20s linear infinite}
  @keyframes pulse-glow{
    0%,100%{transform:scale(1);box-shadow:0 0 12px 3px var(--accent-color), inset 0 0 22px 8px color-mix(in srgb,var(--accent-color),#fff 30%)}
    50%{transform:scale(1.05);box-shadow:0 0 20px 8px var(--accent-color), inset 0 0 30px 12px color-mix(in srgb,var(--accent-color),#fff 20%)}
  }
  .animate-pulse-glow{animation:pulse-glow 3s infinite ease-in-out}
  /* Bloom mastery shimmer (applies to portion beyond 80%) */
  @keyframes shimmer-move {0%{background-position:0 0}100%{background-position:200% 0}}
  .shimmer-ribbon{background-image:linear-gradient(110deg,rgba(255,255,255,0) 0%,rgba(255,255,255,0.35) 40%,rgba(255,255,255,0) 55%,rgba(255,255,255,0.35) 70%,rgba(255,255,255,0) 85%);background-size:200% 100%;animation:shimmer-move 4s linear infinite;mix-blend-mode:plus-lighter;pointer-events:none;}
  /* --- Bloom Prestige Zone Effects (beyond 80%) --- */
  .prestige-segment{position:absolute;inset:0;}
  /* Remember: keep subtle shimmer */
  .prestige-remember::after{content:"";position:absolute;inset:0;@supports not (mix-blend-mode:plus-lighter){opacity:.75};background-image:linear-gradient(105deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.75) 35%,rgba(255,255,255,0) 50%,rgba(255,255,255,.6) 65%,rgba(255,255,255,0) 80%),linear-gradient(110deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.45) 50%,rgba(255,255,255,0) 100%);background-size:180% 100%,220% 100%;animation:remember-double-shimmer 3.2s linear infinite;mix-blend-mode:plus-lighter;pointer-events:none;}
  @keyframes remember-double-shimmer{0%{background-position:0 0,0 0}100%{background-position:200% 0,220% 0}}
  /* Understand: flowing gradient wave (approx sine) */
  .prestige-understand::after{content:"";position:absolute;inset:0;background:
    radial-gradient(circle at 10% 60%,rgba(255,255,255,.55) 0 22%,rgba(255,255,255,0) 60%),
    radial-gradient(circle at 45% 40%,rgba(255,255,255,.45) 0 24%,rgba(255,255,255,0) 62%),
    radial-gradient(circle at 80% 55%,rgba(255,255,255,.5) 0 22%,rgba(255,255,255,0) 60%),
    linear-gradient(90deg,rgba(255,255,255,.15),rgba(255,255,255,0) 40%,rgba(255,255,255,.2) 70%,rgba(255,255,255,0));
    background-size:170% 140%,170% 140%,170% 140%,220% 100%;background-position:0 0,0 0,0 0,0 0;animation:understand-wave-a 6s linear infinite,understand-wave-b 7.5s ease-in-out infinite;mix-blend-mode:overlay;filter:blur(.7px) saturate(1.1);}
  @keyframes understand-wave-a{0%{background-position:0 0,0 0,0 0,0 0}100%{background-position:200% 0,180% 0,160% 0,220% 0}}
  @keyframes understand-wave-b{0%,100%{transform:translateY(0)}50%{transform:translateY(-4%)}}
  /* Apply: glowing edge + ripple inward */
  .prestige-apply{box-shadow:inset 0 0 0 1px rgba(255,255,255,.35),0 0 6px 2px rgba(255,255,255,.35);}
  .prestige-apply::before{content:"";position:absolute;top:0;bottom:0;left:0;width:8px;background:linear-gradient(90deg,rgba(255,255,255,1),rgba(255,255,255,0));filter:blur(1.2px);opacity:1;animation:apply-glow 1.9s ease-in-out infinite;}
  .prestige-apply::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 0 50%,rgba(255,255,255,.6),rgba(255,255,255,0) 72%);transform:scaleX(.65);transform-origin:left center;animation:apply-ripple 2.4s ease-out infinite;mix-blend-mode:screen;}
  @keyframes apply-glow{0%,100%{opacity:1}50%{opacity:.35}}
  @keyframes apply-ripple{0%{transform:scaleX(.4);opacity:.8}55%{transform:scaleX(1.2);opacity:0}100%{transform:scaleX(1.2);opacity:0}}
  /* Analyze: crackling lightning */
  .prestige-analyze::before,.prestige-analyze::after{content:"";position:absolute;inset:0;pointer-events:none;}
  .prestige-analyze::before{background:
      repeating-linear-gradient(75deg,rgba(255,255,255,.85) 0 2px,rgba(255,255,255,0) 2px 8px),
      repeating-linear-gradient(145deg,rgba(255,255,255,.55) 0 1px,rgba(255,255,255,0) 1px 6px);
    background-size:260% 260%;mix-blend-mode:plus-lighter;animation:analyze-crackle-smooth 2.2s linear infinite;opacity:.7;filter:blur(.5px) contrast(1.1);}
  .prestige-analyze::after{background:radial-gradient(circle at 30% 40%,rgba(255,255,255,.45),rgba(255,255,255,0) 65%),radial-gradient(circle at 70% 65%,rgba(255,255,255,.35),rgba(255,255,255,0) 60%);background-size:210% 210%;animation:analyze-fade 4s ease-in-out infinite;mix-blend-mode:screen;}
  @keyframes analyze-crackle-smooth{0%{background-position:0 0,0 0}50%{background-position:130% 90%,120% 80%}100%{background-position:260% 180%,240% 160%}}
  @keyframes analyze-fade{0%,100%{opacity:.95}50%{opacity:.45}}
  /* Evaluate: heat shimmer */
  .prestige-evaluate::before{content:"";position:absolute;inset:-6% 0 -6% 0;background:linear-gradient(90deg,rgba(255,255,255,.55),rgba(255,255,255,0) 30%,rgba(255,255,255,.45) 55%,rgba(255,255,255,0) 78%);background-size:170% 100%;animation:evaluate-heat 4s linear infinite, evaluate-pulse 2.6s ease-in-out infinite;filter:blur(4px) saturate(1.25) brightness(1.05);mix-blend-mode:screen;}
  @keyframes evaluate-heat{0%{background-position:0 0;transform:skewX(0deg)}50%{background-position:150% 0;transform:skewX(4deg)}100%{background-position:0 0;transform:skewX(0deg)}}
  @keyframes evaluate-pulse{0%,100%{opacity:.9}50%{opacity:.55}}
  /* Create: aurora + sparks */
  .prestige-create{background:linear-gradient(100deg,#1dd6ff,#20ffd5,#6a5cff,#20ffd5,#1dd6ff) !important;background-size:400% 200%;animation:create-aurora 10s ease-in-out infinite alternate;position:relative;}
  .prestige-create::before{content:"";position:absolute;inset:0;background:radial-gradient(ellipse at 30% 50%,rgba(255,255,255,.35),rgba(255,255,255,0) 60%),radial-gradient(ellipse at 70% 40%,rgba(255,255,255,.28),rgba(255,255,255,0) 65%);mix-blend-mode:overlay;animation:create-veil 14s linear infinite;}
  .prestige-create::after{content:"";position:absolute;inset:0;animation:create-sparks 6s linear infinite;background:transparent;mix-blend-mode:screen;}
  @keyframes create-aurora{0%{background-position:0 0;filter:hue-rotate(0)}50%{background-position:80% 50%;filter:hue-rotate(25deg)}100%{background-position:0 100%;filter:hue-rotate(-15deg)}}
  @keyframes create-veil{0%{opacity:.9;transform:translateX(0)}50%{opacity:.6;transform:translateX(-6%)}100%{opacity:.9;transform:translateX(0)}}
  @keyframes create-sparks{0%,20%,100%{box-shadow:none}25%{box-shadow:0 0 4px 2px rgba(255,255,255,.9),12px -3px 6px 1px rgba(255,255,255,.55),-14px 2px 5px 1px rgba(255,255,255,.5)}55%{box-shadow:4px 2px 5px 1px rgba(255,255,255,.75),-10px -4px 6px 1px rgba(255,255,255,.45)}75%{box-shadow:0 0 5px 2px rgba(255,255,255,.85),16px 0 8px 2px rgba(255,255,255,.5)}}
  /* Reduced motion: disable animations */
  @media (prefers-reduced-motion:reduce){
    .prestige-remember::after,.prestige-understand::after,.prestige-apply::before,.prestige-apply::after,.prestige-analyze::before,.prestige-analyze::after,.prestige-evaluate::before,.prestige-create,.prestige-create::before,.prestige-create::after{animation:none!important}
  }
}

/* -------------------------------------------------- */
/* Bloom Prestige Sparkle System (global additive)    */
/* Each prestige bar wrapper can opt‑in by adding a   */
/* data-bloom-level attribute (Remember..Create).     */
/* Sparkles float slightly OUTSIDE the bar bounds.    */
/* Higher levels = more particles + multi layers.     */
/* -------------------------------------------------- */
@layer utilities {
  .bloom-prestige-wrapper{position:relative;} /* wrapper retained for layout but no longer renders sparkles */
  /* Reintroduce masked sparkle layer here so it's not clipped by the bar background.
     Mask shows only between 80% and the --prestige-fill value set inline by React. */
  .bloom-prestige-wrapper::before{
    content:"";position:absolute;left:-6%;right:-6%;top:-40%;bottom:-40%;pointer-events:none;z-index:3;
    --dot: var(--dot-size, 3px); --gap-x: var(--gap-x, 36px); --gap-y: var(--gap-y, 18px);
    /* tiled tiny squares (use very small circle to read as dot) */
    background-image:
      radial-gradient(circle var(--dot) at 50% 50%, var(--sparkle-color) 100%, transparent 101%);
    background-size: var(--gap-x) var(--gap-y);
    opacity:var(--sparkle-opacity, .32);mix-blend-mode:screen;filter:drop-shadow(0 0 2px color-mix(in srgb,var(--prestige-color,#fff),#fff 30%));
    animation: wrapper-sparkle-flicker 5.2s linear infinite;
    /* mask between 80% and provided fill (soft extend) — use smoother stop with small gradient ramp */
    -webkit-mask-image: linear-gradient(to right, rgba(0,0,0,0) 0 calc(78%), rgba(0,0,0,.9) calc(80%), rgba(0,0,0,1) calc(80%) calc(var(--prestige-fill, 100%)), rgba(0,0,0,.0) calc(var(--prestige-fill, 100%)) 100%);
    mask-image: linear-gradient(to right, rgba(0,0,0,0) 0 calc(78%), rgba(0,0,0,.9) calc(80%), rgba(0,0,0,1) calc(80%) calc(var(--prestige-fill, 100%)), rgba(0,0,0,.0) calc(var(--prestige-fill, 100%)) 100%);
  }
  /* Fallback sparkle element (used when mask-image isn't supported) */
  .sparkle-fallback{position:absolute;left:0;top:-40%;bottom:-40%;pointer-events:none;z-index:3;mix-blend-mode:screen;overflow:hidden}
  .sparkle-fallback .dots{position:absolute;left:0;top:0;bottom:0;right:0;background-image:radial-gradient(circle var(--dot-size,3px) at 50% 50%, var(--sparkle-color) 100%, transparent 101%);background-size:var(--sparkle-gap-x,36px) var(--sparkle-gap-y,18px);opacity:var(--sparkle-opacity,.32);filter:drop-shadow(0 0 2px color-mix(in srgb,var(--prestige-color,#fff),#fff 30%));animation:wrapper-sparkle-flicker 5.2s linear infinite}
  /* Show fallback only when mask-image is NOT supported */
  @supports not (mask-image: linear-gradient(black, black)){
    .bloom-prestige-wrapper::before{display:none}
    .sparkle-fallback{display:block}
  }
  /* Hide fallback when mask supported */
  @supports (mask-image: linear-gradient(black, black)){
    .sparkle-fallback{display:none}
  }
  @keyframes wrapper-sparkle-flicker{0%,100%{opacity:0}8%{opacity:calc(var(--sparkle-opacity, .32) * .15)}30%{opacity:calc(var(--sparkle-opacity, .32) * .7)}55%{opacity:calc(var(--sparkle-opacity, .32) * 1)}80%{opacity:calc(var(--sparkle-opacity, .32) * .4)}}
  /* Prestige segment color variables */
  .prestige-segment{--prestige-color:var(--bloom-remember);--sparkle-opacity:.45;--sparkle-color:color-mix(in srgb,var(--prestige-color),#fff 40%);} 
  .prestige-segment[data-bloom-level="Remember"]{--prestige-color:var(--bloom-remember);--sparkle-opacity:.40}
  .prestige-segment[data-bloom-level="Understand"]{--prestige-color:var(--bloom-understand);--sparkle-opacity:.55}
  .prestige-segment[data-bloom-level="Apply"]{--prestige-color:var(--bloom-apply);--sparkle-opacity:.70}
  .prestige-segment[data-bloom-level="Analyze"]{--prestige-color:var(--bloom-analyze);--sparkle-opacity:.85}
  .prestige-segment[data-bloom-level="Evaluate"]{--prestige-color:var(--bloom-evaluate);--sparkle-opacity:1.0}
  .prestige-segment[data-bloom-level="Create"]{--prestige-color:var(--bloom-create);--sparkle-opacity:1.15}
  /* Sparkle dots only within prestige zone (80%+) now ONLY on ::before so ::after can shimmer */
  /* secondary confined dot layer — kept for variety but smaller opacity */
  .prestige-segment::before{content:"";position:absolute;top:-10%;bottom:-10%;left:0;right:0;pointer-events:none;mix-blend-mode:plus-lighter;background-image:radial-gradient(circle var(--dot-size,3px) at 50% 50%, var(--sparkle-color) 100%, transparent 101%);background-size:var(--sparkle-gap-x, 36px) var(--sparkle-gap-y,18px);opacity:calc(var(--sparkle-opacity) * .9);filter:drop-shadow(0 0 2px var(--sparkle-color));animation:sparkle-fade 14s linear infinite}
  @keyframes sparkle-fade{0%,100%{opacity:0}12%{opacity:var(--sparkle-opacity)}35%{opacity:calc(var(--sparkle-opacity)*.35)}55%{opacity:calc(var(--sparkle-opacity)*.9)}75%{opacity:calc(var(--sparkle-opacity)*.4)}}
  @media (prefers-reduced-motion:reduce){.prestige-segment::before{animation:none;opacity:.15}}
  /* Dedicated shimmer layer */
  @keyframes prestige-shimmer-move {0%{background-position:0 0,0 0}50%{background-position:130% 0,150% 0}100%{background-position:260% 0,300% 0}}
  .prestige-segment.prestige-remember::after,
  .prestige-segment.prestige-understand::after,
  .prestige-segment.prestige-apply::after,
  .prestige-segment.prestige-analyze::after,
  .prestige-segment.prestige-evaluate::after,
  .prestige-segment.prestige-create::after{content:"";position:absolute;inset:0;pointer-events:none;mix-blend-mode:plus-lighter;animation:prestige-shimmer-move 12s linear infinite;background-image:
    linear-gradient(100deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.55) 10%,rgba(255,255,255,0) 18%,rgba(255,255,255,.55) 26%,rgba(255,255,255,0) 34%,rgba(255,255,255,.55) 42%,rgba(255,255,255,0) 50%,rgba(255,255,255,.55) 58%,rgba(255,255,255,0) 66%,rgba(255,255,255,.55) 74%,rgba(255,255,255,0) 82%,rgba(255,255,255,.55) 90%,rgba(255,255,255,0) 100%);
    background-size:300% 100%;opacity:.85;}
  @media (prefers-reduced-motion:reduce){.prestige-segment.prestige-remember::after,.prestige-segment.prestige-understand::after,.prestige-segment.prestige-apply::after,.prestige-segment.prestige-analyze::after,.prestige-segment.prestige-evaluate::after,.prestige-segment.prestige-create::after{animation:none}}
  /* Remove earlier forced unified shimmer gradients – using pure overlay streaks now */
  .prestige-understand::before,.prestige-apply::before,.prestige-analyze::before,.prestige-evaluate::before,.prestige-create::before{display:none!important}
}

/* Final override to also apply shimmer to remember via shared selector (ensures consistency) */
/* (prestige-remember::after shimmer handled via combined selector above) */

/* -------------------------------------------------- */
/* macOS "Liquid Glass" opt-in styles                 */
/* We scope to .platform-mac to avoid affecting Win   */
/* or other platforms. This is an approximation using */
/* public CSS primitives: translucency, layered noise, */
/* subtle inner border, light bloom highlight.        */
/* Elements can add .liquid-glass OR rely on hooks    */
/* like .site-nav already tagged in React.            */
/* -------------------------------------------------- */
@layer utilities {
  .platform-mac .liquid-glass, .platform-mac .site-nav {
    /* Core translucent panel */
    background: color-mix(in srgb, hsl(var(--background)) 65%, transparent);
    backdrop-filter: saturate(180%) blur(22px);
    -webkit-backdrop-filter: saturate(180%) blur(22px);
    /* position intentionally not set here to allow fixed headers */
  }
  .platform-mac .liquid-glass::before, .platform-mac .site-nav::before {
    /* Inner subtle linear highlight (top) + noise */
    content: "";
    position: absolute; inset: 0; pointer-events: none;
    background:
      linear-gradient(180deg,rgba(255,255,255,.55),rgba(255,255,255,0) 40%),
      linear-gradient(0deg,rgba(255,255,255,.18),rgba(255,255,255,0) 55%),
      /* tiny monochrome noise texture via data URI */
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E") center/160px 160px repeat;
    mix-blend-mode: overlay;
    border-radius: inherit;
  }
  .platform-mac .liquid-glass::after, .platform-mac .site-nav::after {
    /* Inner hairline & outer soft ring */
    content: ""; position: absolute; inset: 0; pointer-events: none; border-radius: inherit;
    box-shadow:
      inset 0 0 0 0.5px rgba(255,255,255,.55),
      inset 0 0 0 1px rgba(255,255,255,.25),
      0 0 0 1px rgba(255,255,255,.08),
      0 4px 24px -4px rgba(0,0,0,.25),
      0 8px 48px -12px rgba(0,0,0,.35);
    mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
    -webkit-mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
    -webkit-mask-composite: xor; mask-composite: exclude; /* cut out middle if we add padding */
  }
  /* Slight hover amplify for interactive glass items */
  .platform-mac .liquid-glass[data-interactive="true"], .platform-mac .site-nav:hover {
    transition: background .4s ease, box-shadow .4s ease;
  }
  .platform-mac .liquid-glass[data-interactive="true"]:hover {
    background: color-mix(in srgb, hsl(var(--background)) 75%, transparent);
    box-shadow: 0 4px 28px -6px rgba(0,0,0,.35), 0 8px 56px -10px rgba(0,0,0,.45);
  }
  @media (prefers-color-scheme: dark) {
    .platform-mac .liquid-glass, .platform-mac .site-nav {
      background: color-mix(in srgb, hsl(var(--background)) 35%, rgba(30,30,30,.35));
    }
    .platform-mac .liquid-glass::before, .platform-mac .site-nav::before {
      background:
        linear-gradient(180deg,rgba(255,255,255,.18),rgba(255,255,255,0) 45%),
        linear-gradient(0deg,rgba(255,255,255,.10),rgba(255,255,255,0) 55%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E") center/160px 160px repeat;
      mix-blend-mode: plus-lighter;
    }
  }
  /* Utility class if we want to tag arbitrary panels via Tailwind @apply */
  .platform-mac .glass-card { border-radius: 0.75rem; }
}

/* Ensure global nav remains fixed regardless of scroll container quirks */
@layer utilities {
  .site-nav { position: fixed; top: 0; left: 0; right: 0; }
  /* Hardening: ensure no future utility overrides (tailwind ordering edge) */
  header.site-nav { position: fixed !important; }
}

/* -------------------------------------------------- */
/* Tailwind-agnostic Liquid Glass utility classes     */
/* (scoped to mac platform so Windows/Linux unaffected) */
/* -------------------------------------------------- */
@layer utilities {
  .platform-mac .lg-regular {
    --lg-tint: rgba(255,255,255,0.06);
    --lg-specular: rgba(255,255,255,0.35);
    --lg-border: rgba(255,255,255,0.18);
    background: linear-gradient(180deg, var(--lg-tint) 0%, rgba(255,255,255,0.02) 100%);
    -webkit-backdrop-filter: saturate(140%) blur(16px);
    backdrop-filter: saturate(140%) blur(16px);
    border: 1px solid var(--lg-border);
    box-shadow: inset 0 1px 0 var(--lg-specular), 0 1px 8px rgba(0,0,0,0.18);
    border-radius: 16px;
  }
  .platform-mac .lg-clear {
    --lg-tint: rgba(255,255,255,0.02);
    --lg-specular: rgba(255,255,255,0.28);
    --lg-border: rgba(255,255,255,0.14);
    background: linear-gradient(180deg, var(--lg-tint) 0%, rgba(255,255,255,0) 100%);
    -webkit-backdrop-filter: saturate(110%) blur(24px);
    backdrop-filter: saturate(110%) blur(24px);
    border: 1px solid var(--lg-border);
    box-shadow: inset 0 1px 0 var(--lg-specular), 0 1px 8px rgba(0,0,0,0.15);
    border-radius: 16px;
  }
  /* Ultra-transparent glass with edge distortion for popovers */
  .platform-mac .lg-ultra-clear {
    --lg-tint: transparent;
    --lg-edge-glow: rgba(255,255,255,0.33);
    --lg-border: rgba(255,255,255,0.15);
    position: relative;
    background: transparent;
    -webkit-backdrop-filter: saturate(120%) blur(8px) contrast(101%);
    backdrop-filter: saturate(120%) blur(8px) contrast(101%);
    border: 1.5px solid var(--lg-border);
    box-shadow: 
      inset 0 0 0 1px var(--lg-edge-glow),
      inset 0 1px 4px rgba(255,255,255,0.08),
      0 0 0 0.5px rgba(255,255,255,0.12),
      0 8px 32px -8px rgba(0,0,0,0.18),
      0 16px 64px -12px rgba(0,0,0,0.12);
    border-radius: 14px;
  }
  /* Add edge distortion effect via pseudo-element */
  .platform-mac .lg-ultra-clear::before {
    content: "";
    position: absolute;
    inset: -2px;
    pointer-events: none;
    background: 
      /* Corner distortions - stronger, more concentrated */
      radial-gradient(ellipse 30% 35% at 5% 5%, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.08) 30%, transparent 60%),
      radial-gradient(ellipse 30% 35% at 95% 5%, rgba(255,255,255,0.16) 0%, rgba(255,255,255,0.07) 30%, transparent 60%),
      radial-gradient(ellipse 30% 35% at 5% 95%, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.06) 30%, transparent 60%),
      radial-gradient(ellipse 30% 35% at 95% 95%, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.06) 30%, transparent 60%),
      /* Edge distortions - linear gradients along edges */
      linear-gradient(to right, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.04) 8%, transparent 15%),
      linear-gradient(to left, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.04) 8%, transparent 15%),
      linear-gradient(to bottom, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.05) 8%, transparent 15%),
      linear-gradient(to top, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.04) 8%, transparent 15%);
    border-radius: inherit;
    mix-blend-mode: overlay;
    filter: blur(1.5px);
  }
  .platform-mac .lg-specular { position: relative; overflow: hidden; }
  .platform-mac .lg-specular::after {
    content: ""; position: absolute; inset: -200% -40%;
    background: radial-gradient(120% 20% at 50% 0%, rgba(255,255,255,.25), rgba(255,255,255,0) 55%);
    transform: translateY(65%); transition: transform 400ms ease; pointer-events: none;
  }
  .platform-mac .lg-specular:hover::after,
  .platform-mac .lg-specular:focus-visible::after { transform: translateY(40%); }
  /* Dark mode subtle tuning */
  .platform-mac.dark .lg-regular, .dark .platform-mac .lg-regular { --lg-tint: rgba(40,40,40,0.55); background: linear-gradient(180deg, var(--lg-tint) 0%, rgba(40,40,40,0.25) 100%); }
  .platform-mac.dark .lg-clear, .dark .platform-mac .lg-clear { --lg-tint: rgba(30,30,30,0.35); background: linear-gradient(180deg, var(--lg-tint) 0%, rgba(30,30,30,0.1) 100%); }
  .platform-mac.dark .lg-ultra-clear, .dark .platform-mac .lg-ultra-clear { 
    --lg-tint: rgba(20,20,20,0.01); 
    --lg-edge-glow: rgba(255,255,255,0.08);
    --lg-border: rgba(255,255,255,0.06);
    background: transparent;
  }
  /* Reduced transparency fallback (non-standard MQ; gracefully ignored if unsupported) */
  @media (prefers-reduced-transparency: reduce) {
    .platform-mac .lg-regular, .platform-mac .lg-clear, .platform-mac .lg-ultra-clear {
      -webkit-backdrop-filter: none; backdrop-filter: none; background: rgba(240,240,240,.85); box-shadow: 0 1px 4px rgba(0,0,0,.15);
    }
    .platform-mac.dark .lg-regular, .platform-mac.dark .lg-clear, .platform-mac.dark .lg-ultra-clear { background: rgba(30,30,30,.85); }
  }
  /* Provide alternative accessibility hook using prefers-reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    .platform-mac .lg-specular::after { transition: none; }
  }
}

